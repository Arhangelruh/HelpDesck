@model FullRequestViewModel
@using HelpDesk.Common.Constants;


<div class="container_head">
    <div class="requestinfo">
        <div class="name_request">Заявка №<div class="number_request" name ="@Model.Id">@Model.Id</div></div>
        <div>Тема: @Model.Theme</div>
    </div>
    <div class="requeststatus">
        Статус заявки: @Model.Status
    </div>
</div>

<div class="container_buttoms">
    @if (Model.StatusQueue == 1)
    {
        <a class="a_buttom" asp-controller="Request" asp-action="DeleteRequest" asp-route-requestId="@Model.Id">
            <div class="request_buttom">
                Удалить
            </div>
        </a>
        <a class="a_buttom" asp-controller="Request" asp-action="EditRequest" asp-route-requestId="@Model.Id">
            <div class="request_buttom">
                Редактировать
            </div>
        </a>
        <a class="a_buttom" asp-controller="Request" asp-action="SendRequest" asp-route-requestId="@Model.Id">
            <div class="request_buttom">
                Отправить
            </div>
        </a>

    }
    @if (Model.StatusQueue == 2)
    {
        @if (User.Identity.IsAuthenticated)
        {
            if (User.IsInRole(UserConstants.AdminRole))
            {
                <a class="a_buttom" asp-controller="Request" asp-action="InWork" asp-route-requestId="@Model.Id">
                    <div class="request_buttom">
                        В работу
                    </div>
                </a>
            }
        }
    }
    @if (Model.Statuses.Any() && Model.StatusQueue > 2)
    {
        foreach (var status in Model.Statuses)
        {
            <a class="a_buttom" asp-controller="Request" asp-action="ChangeStatus" asp-route-requestId="@Model.Id" asp-route-statusId="@status.Id">
                <div class="request_buttom">
                    @status.StatusNameFromButton
                </div>
            </a>
        }
    }

    <button class="comment_button request_buttom">Комментарий</button>
    <button class="addfile_button request_buttom">Добавить файл</button>
</div>

<div class="added_file" style="display:none;">
    <div class="file_size_message">
        Размер файла не должен превышать 10Mb
    </div>
    <form class="added_file_form" asp-controller="File" asp-action="AddFile" method="post" enctype="multipart/form-data">
        <div class="file_form_field">
            <input type="hidden" asp-for="Id" />
        </div>
        <div class="file_form_field danloadfile_field">
            <label for="myfile" class="file_lable">
                <span class="input_file_icon"></span>
                <span class="input_file_button_text">Выберите файл</span>
            </label>
            <label class="file_name_field">Файл не выбран</label>
            <input type="file" class="myfile" id="myfile" name="FileBody" />
            <div class="addfileform_buttons">
                <button class="addfileform_button revert_addfile_button" type="reset" title="Отменить">
                    <div class="addfile_button_img">
                        <img src="~/images/Delete_Comment.svg">
                        <div class="addfile_text_img">Отменить</div>
                    </div>
                </button>
                <button class="addfileform_button" id="addmyfile" type="submit" title="Добавить">
                    <div class="addfile_button_img">
                        <img src="~/images/Add_comment.svg">
                        <div class="addfile_text_img">Добавить</div>
                    </div>
                </button>
            </div>
        </div>
    </form>
</div>
@if(Model.Files.Any()){
<div class="container_files">
    <ol class="file_list">
        @foreach (var file in Model.Files)
        {
            <li class="danloadded_file">
                <div class="danloaded_file_name">
                    <a class="danloaded_file_body" asp-controller="File" asp-action="GetFile" asp-route-fileId="@file.Id">
                        @file.Name
                    </a>                      
                </div>
                <div class="danloaded_file_control">
                    <a class="danloaded_file_body_button" asp-controller="File" asp-action="GetFile" asp-route-fileId="@file.Id">
                        <div class="file_button">
                            <img src="~/images/DownloadFile.svg" />
                            <div class="danload_file_textImg">Загрузить</div>
                        </div>
                    </a>
                    @if (User.IsInRole(UserConstants.AdminRole))
                    {
                    <a class="danloaded_file_body_button" asp-controller="File" asp-action="DeleteFile" asp-route-fileId="@file.Id" asp-route-requestId="@Model.Id">
                        <div class="file_button">Удалить</div>
                    </a>
                    }
                </div>
            </li>
        }
    </ol>
</div>
}

<div class="request_body">
<div class="container_request">
    <div class="description_request">
        <div class="requestadress">IP адрес: @Model.Ip</div>
        <div class="name_field">Описание</div>
        <div class="description">@Model.Description</div>
    </div>
    
<div class="request_comments">
    @if (Model.Comments.Any())
    {
        <div class="block_comment_name">Комментарии:</div>
        <div class="allcomments">
            @foreach(var comment in Model.Comments)
                {
            <div class="comment">
                <div class="comment_information">
                    <div class="comment_creator padding_five">@comment.Profile</div>
                    <div class="comment_time padding_five">@comment.CreateComment</div>
                </div>
                <div class="comment_text">@comment.Comment</div>
            </div>                  
                }
        </div>
    }
    <button class="comment_button request_buttom">Комментарий</button>
 <div class="added_comment" style="display:none;">
     <form class="comment_form" action="AddComment" method="post">
         <div class="comment_form_field">
             <label for="comment">Комментарий:</label>
         </div>
         <div class="comment_form_field">
             <input type="hidden" asp-for="Id" />             
         </div>
         <div class="comment_form_field">
             <textarea class="comment_area" required placeholder="Введите коментарий и нажмите добавить." name="comment" id="comment"></textarea>
         </div>
         <div class="comment_form_field">
             <div class="commentform_buttons">
                 <button class="commentform_button revert_comment_button" type="reset" title="Отменить">
                     <div class="comment_button_img">
                         <img src="~/images/Delete_Comment.svg">
                         <div class="comment_text_img">Отменить</div>
                     </div>
                 </button>
                 <button class="commentform_button" type="submit" title="Добавить">
                     <div class="comment_button_img">
                         <img src="~/images/Add_comment.svg">
                         <div class="comment_text_img">Добавить</div>
                     </div>
                 </button>
             </div>
         </div>
     </form>
 </div>
    </div>
</div>
<div class="request_extra">
		<div class="users_request">
			<div class="autor_request">
				Автор:
				@Model.Creator
			</div>
			<div class="admin_request">
				В работе:
				@Model.Admin
			</div>
		</div>
		<div class="request_chat"> 
            <input type="hidden" id="userName" value="@User.Identity.Name" />
            <input type="hidden" id="userGroup" value="@Model.Id" />
                <div class="chat_message">
                    <div class="chat_message_name">Чат:</div>
                    <div class="chat_message_text"><input type="text" id="message"/></div>
                </div>
            <div class="chat_list" id="chatroom"></div>
        </div>
</div>

</div>
   
    @section css {
        <link href="~/css/request.css" rel="stylesheet" asp-append-version="true" />
    }

    @section js {
        <script src="~/js/comments.js" asp-append-version="true"></script>
        <script src="~/js/addfile.js" asp-append-version="true"></script>
        <script src="~/js/signalr/dist/browser/signalr.js" asp-append-version="true"></script>
        <script src="~/js/chat.js" asp-append-version="true"></script>
    }
